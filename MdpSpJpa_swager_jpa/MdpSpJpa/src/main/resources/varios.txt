CREATE TABLE usuarios (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY, -- Clave primaria autoincremental
    nombre VARCHAR2(50) NOT NULL,  -- Nombre del usuario
    apellido VARCHAR2(50) NOT NULL -- Apellido del usuario
);


INSERT INTO usuarios (nombre, apellido) VALUES ('Juan', 'Pérez');
INSERT INTO usuarios (nombre, apellido) VALUES ('María', 'González');

COMMIT; -- Guardar los cambios

CREATE OR REPLACE PROCEDURE sp_ObtenerUsuarios (
    p_cursor OUT SYS_REFCURSOR,
    p_estado OUT VARCHAR2,
    p_estado_creacion OUT VARCHAR2
)
IS
BEGIN
    -- Intentamos abrir el cursor con los datos de usuarios
    OPEN p_cursor FOR
    SELECT nombre, apellido FROM USUARIOS;

    -- Si se ejecuta correctamente, establecemos valores de éxito
    p_estado := 'OK';
    p_estado_creacion := 'Datos obtenidos correctamente';

EXCEPTION
    WHEN OTHERS THEN
        -- Capturamos cualquier error y devolvemos un mensaje de error
        p_estado := 'ERROR';
        p_estado_creacion := 'Error en la ejecución: ' || SQLERRM;
END sp_ObtenerUsuarios;
/
commit;